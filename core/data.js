import { parseCSV,nrmU,weekNum } from './utils.js'; import { Store } from './store.js'; async function fetchCSV(u){if(!u)return[];const r=await fetch(u,{cache:'no-store'});return parseCSV(await r.text());} export async function loadCalendario(){const rows=await fetchCSV(Store.state.config.sheets.calendario); Store.state.calendario=rows; return rows;} export async function loadLlamadas(){const rows=await fetchCSV(Store.state.config.sheets.llamadas); Store.state.llamadas=rows; return rows;} export async function loadClientes(){const rows=await fetchCSV(Store.state.config.sheets.clientes); Store.state.clientes=rows; return rows;} export async function loadUsuarios(){const rows=await fetchCSV(Store.state.config.sheets.usuarios); Store.state.usuarios=rows; return rows;} export function canonPlan(rows){return rows.map(r=>({semana:weekNum(r['SEMANA']??r['N Semana']??r['N° Semana']??r['N_Semana']??''),dia:nrmU(r['DIA']??r['Día']??r['day']??''),vendedor:nrmU(r['vendedor']??r['Vendedor']??''),gestor:nrmU(r['gestor_servicio']??r['Gestor Servicio']??r['gestor']??'NO ASIGNADO'),cod:nrmU(r['Cod Empresa']??r['Código']??r['Cod']??r['ID']??''),nombre:r['RazonSocial']??r['Cliente']??r['Nombre']??''})).filter(x=>x.semana);} export function canonCalls(rows){return rows.map(r=>({semana:weekNum(r['Semana']??r['SEMANA']??r['semana']??''),gestor:nrmU(r['gestor_servicio']??r['Gestor Servicio']??r['gestor']??r['Gestor']??''),fecha:r['fecha']??r['Fecha']??''}));}